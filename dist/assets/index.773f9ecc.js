import*as o from"https://cdn.skypack.dev/three@0.133.0";import{OrbitControls as ee}from"https://cdn.skypack.dev/pin/three@v0.133.0-mRqtjW5H6POaf81d9bnr/mode=imports/unoptimized/examples/jsm/controls/OrbitControls.js";import{GLTFLoader as J}from"https://cdn.skypack.dev/pin/three@v0.133.0-mRqtjW5H6POaf81d9bnr/mode=imports/unoptimized/examples/jsm/loaders/GLTFLoader.js";import{DecalGeometry as te}from"https://cdn.skypack.dev/pin/three@v0.133.0-mRqtjW5H6POaf81d9bnr/mode=imports/unoptimized/examples//jsm/geometries/DecalGeometry.js";import"https://cdn.skypack.dev/pin/three@v0.133.0-mRqtjW5H6POaf81d9bnr/mode=imports/unoptimized/examples/jsm/lights/LightProbeGenerator.js";import{S as oe,G as ne}from"./vendor.7fc611f1.js";const ie=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function r(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerpolicy&&(l.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?l.credentials="include":a.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(a){if(a.ep)return;a.ep=!0;const l=r(a);fetch(a.href,l)}};ie();function re(){list.printListData();var t=new Blob(["identifier PANGU: Boulder List File",`
`,"horizontal_scale 1",`
`,"offset 0 0",`
`,"// Each line following this comment is a crater definition consisting of four required and six optional values.",`
`,"// x_pos y_pos diameter age [irregularity mode] [irregularity ratio] [replace] [secondary] [infill height] [related boulders]",`
`,boulderString],{type:"text/plain;charset=utf-8",endings:"native"}),e=new Blob(["identifier PANGU: Crater List File",`
`,"horizontal_scale 1",`
`,"offset 0 0",`
`,"size 513 513",`
`,"// Each line following this comment is a crater definition consisting of four required and six optional values.",`
`,"// x_pos y_pos diameter age [irregularity mode] [irregularity ratio] [replace] [secondary] [infill height] [related boulders]",`
`,craterString],{type:"text/plain;charset=utf-8",endings:"native"});saveAs(t,"boulder_list.txt"),saveAs(e,"crater_list.txt")}let h,s,g,p,u,H;var C,A,D,W=1,_=1;const ae=[];var M,se;let n;const w={intersects:!1,point:new o.Vector3,normal:new o.Vector3},E=new o.Vector2,b=[];let d;const V=new o.Vector3,G=new o.Euler,X=new o.Vector3(8,8,8);let j,z,O;const B={lightProbeIntensity:1,directionalLightIntensity:.2,ambientLightIntensity:1,directionalLightColour:16777215,ambientLightColour:16777215},R=oe();document.body.appendChild(R.dom);R.domElement.style.cssText="position: fixed; bottom: 0; right: 100;cursor:pointer;opacity:0.9;z-index:10000";window.Mode_Update=function(){filter.addEventListener("change",filterChanged);var t=document.getElementById("modepicker");t.value,console.log(t)};window.onload=function(){W=document.getElementById("modepicker"),console.log(W)};window.printList=function(t){document.getElementById("Coord_List").value=t};window.reload=function(){Q()};function Q(){document.getElementById("loaded").style.visibility="hidden",document.getElementById("zone").style.visibility="hidden",be(),h=new o.WebGLRenderer,h.setSize(window.innerWidth,window.innerHeight,!1),document.body.appendChild(h.domElement),h.outputEncoding=o.sRGBEncoding,h.toneMapping=o.NoToneMapping,s=new o.Scene,s.background=new o.Color(0),g=new o.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,5e3),g.position.set(0,0,300),s.add(g),C=new o.AxesHelper(2e3),C.position.set(0,0,0),s.add(C),C.visible=!1,j=new o.LightProbe,s.add(j),z=new o.DirectionalLight(B.directionalLightColour,B.directionalLightIntensity),z.position.set(10,10,10),s.add(z),O=new o.AmbientLight(B.ambientLightColour,B.ambientLightIntensity),s.add(O);const t=new o.BufferGeometry;t.setFromPoints([new o.Vector3,new o.Vector3]),H=new o.Line(t,new o.LineBasicMaterial({color:16776960})),s.add(H);const e=new o.Raycaster;new o.Vector2,d=new o.Mesh(new o.BoxGeometry(1,1,10),new o.MeshBasicMaterial({color:16776960})),d.visible=!0,s.add(d);const r=new ee(g,h.domElement);r.addEventListener("change",v),r.minDistance=100,r.maxDistance=2e3,r.enablePan=!1,fe();function i(c,P){if(p!==void 0)if(E.x=c/window.innerWidth*2-1,E.y=-(P/window.innerHeight)*2+1,E.x-h.left,e.setFromCamera(E,g),e.intersectObject(p,!1,b),b.length>0){const m=b[0].point;d.position.copy(m),w.point.copy(m);const f=b[0].face.normal.clone();f.transformDirection(p.matrixWorld),f.multiplyScalar(10),f.add(b[0].point),w.normal.copy(b[0].face.normal),d.lookAt(f);const x=H.geometry.attributes.position;x.setXYZ(0,m.x,m.y,m.z),x.setXYZ(1,f.x,f.y,f.z),x.needsUpdate=!0,w.intersects=!0,b.length=0}else w.intersects=!1}window.addEventListener("resize",q);let a=!1;r.addEventListener("change",function(){a=!0}),window.addEventListener("pointerdown",function(){a=!1}),window.addEventListener("pointerup",function(c){c.shiftKey&&a===!1&&(i(c.clientX,c.clientY),w.intersects&&M==1?(Y(),list.insertFirst(2,A,D,40,0,1),console.log(se)):w.intersects&&M==0?(new J().load("models/Bennu_1_1.glb",function(m){u=m.scene.children[0];const f=u.uuid;ae[f]={model:m,mydata:{userPlaced:!0}},u.position.set(d.position.x,d.position.y,d.position.z),u.material=new o.MeshBasicMaterial({color:16776960,wireframe:!1,opacity:.5,transparent:!0}),u.material.opacity=.5,u.userData.draggable=!0,u.userData.moved=!1,u.userData.asteroid=!1,s.add(u),u.scale.set(_/100,_/100,_/100),pe(),console.log(u.uuid,"  :  ",D," , ",A)}),ce(),n.X_Coordinate=d.position.x,n.Y_Coordinate=d.position.y,n.Z_Coordinate=d.position.z,n.Latitude=A,n.Longitude=D):w.intersects&&M==1&&Y())}),window.addEventListener("pointermove",l);function l(c){c.isPrimary&&i(c.clientX,c.clientY)}v(),window.addEventListener("resize",q)}const de=new o.BoxGeometry(1,1,1),le=new o.MeshBasicMaterial({color:65280});function ce(){const t=new o.Mesh(de,le);t.position.set(d.position.x,d.position.y,d.position.z),s.add(t),t.position.normalize();var e=-Math.atan2(-t.position.z,-t.position.x)-Math.PI/2;e<-Math.PI&&(e+=Math.PI*2);var r=new o.Vector3(t.position.x,0,t.position.z);r.normalize();var i=Math.acos(r.dot(t.position));return t.position.y<0&&(i*=-1),i=i*180/Math.PI,e=e*180/Math.PI,e<0&&(e=e+360),A=i,D=e,console.log("long and lat : ",e,i),[e,i]}function fe(){new J().parse(N,"",e=>{p=e.scene.children[0],s.add(p),p.scale.set(.5,.5,.5),p.userData.asteroid=!0,p.traverse(r=>{})})}function Y(){V.copy(w.point),G.copy(d.rotation),G.z=Math.random()*2*Math.PI;const t=_+.02;X.set(t,t,t);const e=new o.MeshBasicMaterial({color:16776960,map:o.ImageUtils.loadTexture("images/marker_mask5.png"),alphaTest:.5});e.polygonOffset=!0,e.depthTest=!0,e.polygonOffsetFactor=-4,e.polygonOffsetUnits=.1;const r=new o.Mesh(new te(p,V,G,X),e);r.userData.draggable=!0,s.add(r),console.log(r.scale)}function q(){h.setSize(window.innerWidth,window.innerHeight),g.aspect=window.innerWidth/window.innerHeight,g.updateProjectionMatrix(),v()}function v(){ue(),requestAnimationFrame(v),h.render(s,g),R.update()}var N,Z;const I=document.querySelector('input[type="file"]');I.addEventListener("change",function(t){console.log(I.files);const e=new FileReader;e.onload=function(){N=e.result,Z=URL.createObjectURL(I.files[0]),console.log(N),console.log(Z),Q()},e.readAsArrayBuffer(I.files[0])},!1);const F=new o.Raycaster,T=new o.Vector2,k=new o.Vector2;var L=new o.Object3D;window.addEventListener("contextmenu",function(t){T.x=t.clientX/window.innerWidth*2-1,T.y=-(t.clientY/window.innerHeight)*2+1,F.setFromCamera(T,g);const e=F.intersectObjects(s.children,!0);if(L){e[0].object.userData.moved==!0&&(e[0].object.material.opacity=.5),L=null;return}e.length>0&&e[0].object.userData.draggable&&(L=e[0].object,e[0].object.material.opacity=.9,e[0].object.userData.moved=!0,console.log(e[0].object.uuid," : Has been moved"))},!1);window.addEventListener(k,t=>{k.x=t.clientX/window.innerWidth*2-1,k.y=-(t.clientY/window.innerHeight)*2+1});function ue(){if(L!=null){F.setFromCamera(k,g);const t=F.intersectObjects(s.children);if(t.length>0)for(let e of t)if(e.object.userData.asteroid)L.position.x=d.position.x,L.position.y=d.position.y,L.position.z=d.position.z;else continue}}window.locationUpdater=function(){s.traverse(function(t){if(t.userData.asteroid==!1){t.position.normalize();var e=-Math.atan2(-t.position.z,-t.position.x)-Math.PI/2;e<-Math.PI&&(e+=Math.PI*2);var r=new o.Vector3(t.position.x,0,t.position.z);r.normalize();var i=Math.acos(r.dot(t.position));t.position.y<0&&(i*=-1),i=i*180/Math.PI,e=e*180/Math.PI,e<0&&(e=e+360),console.log(t.uuid,"  :  ",i," , ",e),list.insertFirst(t.uuid,1,i,e,40,0,1)}}),re()};const $=new o.Box3,K=new o.Box3Helper($,16776960);function pe(){$.setFromObject(p,!0),s.add(K),s.remove(K)}var me="N/A",ge="N/A",he="N/A",we="N/A",ye="N/A";function be(){const t=new ne({width:310}),e=t.addFolder("Placement Tools"),r=t.addFolder("Placement Information"),i=t.addFolder("Scene Options"),a=t.addFolder("Save Changes");n={Wireframe:!1,AxesHelper:!1,"Export Lists":c,"Object Size":1,"Object Type":"Rock",X_Coordinate:me,Y_Coordinate:ge,Z_Coordinate:he,Latitude:we,Longitude:ye,Background_Colour:"rgb(0,0,0)",Ambient_Light:1.5,Direct_Light:1.5,Probe_Light:1.5,Ambient_Colour:"rgb(255,255,255)",Direct_Colour:"rgb(255,255,255)"},e.add(n,"Wireframe").onChange(l),e.add(n,"AxesHelper").onChange(x),e.add(n,"Object Size",1,10,1).onChange(P),e.add(n,"Object Type",["Rock","Crater"]).onChange(m),r.add(n,"X_Coordinate").listen().disable(),r.add(n,"Y_Coordinate").listen().disable(),r.add(n,"Z_Coordinate").listen().disable(),r.add(n,"Latitude").listen().disable(),r.add(n,"Longitude").listen().disable(),i.addColor(n,"Background_Colour").onChange(f),i.add(n,"Ambient_Light",0,1,.02).onChange(S),i.add(n,"Direct_Light",0,1,.02).onChange(S),i.add(n,"Probe_Light",0,1,.02).onChange(S),i.addColor(n,"Ambient_Colour").onChange(U),i.addColor(n,"Direct_Colour").onChange(U),a.add(n,"Export Lists");function l(y){p.material.wireframe=y}function c(){locationUpdater()}function P(y){_=y}function m(y){y=="Rock"?M=0:M=1}function f(){s.background=new o.Color(n.Background_Colour)}function x(y){y==!0?C.visible=!0:C.visible=!1}function S(){j.intensity=n.Probe_Light,v(),z.intensity=n.Direct_Light,v(),O.intensity=n.Ambient_Light,v()}function U(){z.color=new o.Color(n.Direct_Colour),O.color=new o.Color(n.Ambient_Colour)}i.close()}
